# ============================================================
# Apollo Pump - Home Assistant Card Template
# ============================================================
# SETUP INSTRUCTIONS:
# 1. Find your device's MAC suffix in ESPHome or Home Assistant
#    - In ESPHome: Look for device name like "apollo-pump-1-a1b2c3"
#    - In Home Assistant: Check Settings > Devices > Apollo Pump
#    - The suffix is the last 6 characters (e.g., "a1b2c3")
#
# 2. Use Find & Replace in your text editor:
#    Find:    {DEVICE_SUFFIX}
#    Replace: your-actual-suffix (e.g., a1b2c3)
#
# 3. Copy the entire card into Home Assistant dashboard
#    - Go to your dashboard
#    - Click "Edit Dashboard" (top right)
#    - Click "Add Card" > "Manual" (at bottom)
#    - Paste the modified YAML
#
# REQUIREMENTS:
# - HACS installed (https://hacs.xyz/)
# - fold-entity-row custom card installed via HACS
#   (HACS > Frontend > Search "fold-entity-row" > Install)
# ============================================================

type: entities
title: üí¶ Apollo Pump-1
show_header_toggle: false
state_color: true
entities:
  # Main Controls - Always Visible
  - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_system_enable_pump_logic
    name: "üîå System Enable"
    icon: mdi:power
  - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_manual_run_pump
    name: "‚ñ∂Ô∏è Manual Run"
    icon: mdi:play-circle

  # Operating Mode - Always Visible
  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_operating_mode
    name: "üìä Operating Mode"
    icon: mdi:cog
  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_pump_diagnostic
    name: "üîç Pump Status"
    icon: mdi:information-outline

  # Fluid Est. Remaining (oz) - Only visible in Cycle (Dispensing) Mode
  - type: conditional
    conditions:
      - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_cycle_enable_limiting
        state: "on"
    row:
      entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_cycle_est_remaining_oz
      name: "üíß Fluid Est. Remaining (oz)"
      icon: mdi:water-percent

  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_pump_cycle_count
    name: "üî¢ Pump Cycles"
    icon: mdi:counter
  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_last_auto_run
    name: "üïê Last Auto Run"
    icon: mdi:clock-outline
  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_next_auto_run
    name: "üïë Next Auto Run"
    icon: mdi:clock-check-outline

  # Trigger Mode Indicator - Only visible when trigger mode is active
  - type: conditional
    conditions:
      - entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_trigger_mode_active
        state: "on"
    row:
      entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_trigger_mode_active
      name: "‚ö° Trigger Mode Active"
      icon: mdi:lightning-bolt

  # Run Until Full - Only visible when OUTPUT sensor is in Safety mode
  - type: conditional
    conditions:
      - entity: select.apollo_pump_1_{DEVICE_SUFFIX}_sensor_output_mode
        state: "Safety"
    row:
      entity: button.apollo_pump_1_{DEVICE_SUFFIX}_manual_run_until_full
      name: "‚ñ∂Ô∏è Run Until Full"
      icon: mdi:play-circle-outline

  # Run Until Empty - Only visible when INPUT sensor is in Safety mode AND in Continuous Mode
  - type: conditional
    conditions:
      - entity: select.apollo_pump_1_{DEVICE_SUFFIX}_sensor_input_mode
        state: "Safety"
      - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_cycle_enable_limiting
        state: "off"
    row:
      entity: button.apollo_pump_1_{DEVICE_SUFFIX}_manual_run_until_empty
      name: "‚ñ∂Ô∏è Run Until Empty"
      icon: mdi:play-circle-outline

  - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_fw_version
    name: "üìü FW Version"
    icon: mdi:chip

  - type: divider

  # Main Settings Section - Contains all collapsible sections
  - type: custom:fold-entity-row
    head:
      type: section
      label: ‚öôÔ∏è Settings
    padding: 5
    entities:
      # Mode Settings - Collapsible
      - type: custom:fold-entity-row
        head:
          type: section
          label: ‚öôÔ∏è Mode Settings
        padding: 5
        entities:
          - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_cycle_enable_limiting
            name: "üîÑ Mode: Continuous ‚Üî Cycle (Dispensing)"
            icon: mdi:sync

      # CYCLE MODE ENTITIES - Only visible when Cycle Limiting is ON
      - type: conditional
        conditions:
          - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_cycle_enable_limiting
            state: "on"
        row:
          type: custom:fold-entity-row
          head:
            type: section
            label: üîÑ Cycle Mode Management
          padding: 5
          entities:
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cont_interval_hours
              name: "Interval (Hours)"
              icon: mdi:timer-outline
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cont_run_duration_sec
              name: "Run Duration (Seconds)"
              icon: mdi:timer-sand
            - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_pump_cycle_count
              name: "Cycle Count"
              icon: mdi:counter
            - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_cycle_est_remaining_oz
              name: "Fluid Est. Remaining (oz)"
              icon: mdi:water-percent
            - entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_pump_alert_active
              name: "Alert Active"
              icon: mdi:alert
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cycle_max_count
              name: "Max Cycle Count"
              icon: mdi:numeric
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cycle_refill_size_oz
              name: "Refill Size (oz)"
              icon: mdi:cup-water
            - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_cycle_confirm_refill
              name: "‚úÖ Confirm Refill"
              icon: mdi:check-circle
            - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_cycle_reset_counter
              name: "üîÑ Reset Counter"
              icon: mdi:restart

      # CONTINUOUS MODE ENTITIES - Only visible when Cycle Limiting is OFF
      - type: conditional
        conditions:
          - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_cycle_enable_limiting
            state: "off"
        row:
          type: custom:fold-entity-row
          head:
            type: section
            label: ‚è±Ô∏è Continuous Mode Management
          padding: 5
          entities:
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cont_interval_hours
              name: "Interval (Hours)"
              icon: mdi:timer-outline
            - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_cont_run_duration_sec
              name: "Run Duration (Seconds)"
              icon: mdi:timer-sand
            - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_cycle_reset_counter
              name: "üîÑ Reset Counter"
              icon: mdi:restart

      # Time Synchronization - NEW SECTION
      - type: custom:fold-entity-row
        head:
          type: section
          label: ‚è∞ Time Synchronization
        padding: 5
        entities:
          - entity: text.apollo_pump_1_{DEVICE_SUFFIX}_time_timezone
            name: "üåç Timezone"
            icon: mdi:map-clock-outline
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_time_sntp_status
            name: "üì° SNTP Status"
            icon: mdi:clock-check
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_time_current_timezone
            name: "üó∫Ô∏è Active Timezone"
            icon: mdi:map-clock
          - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_system_force_time_sync
            name: "üîÑ Force Time Sync"
            icon: mdi:clock-check
          - type: divider
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_last_auto_run
            name: "Last Auto Run"
            icon: mdi:clock-outline
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_next_auto_run
            name: "Next Auto Run"
            icon: mdi:clock-check-outline

      # Status & Monitoring
      - type: custom:fold-entity-row
        head:
          type: section
          label: üìä Status & Monitoring
        padding: 5
        entities:
          - entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_ha_connected
            name: "Home Assistant"
            icon: mdi:home-assistant
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_status_wifi_ssid
            name: "WiFi Network"
            icon: mdi:wifi
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_rssi
            name: "Signal Strength"
            icon: mdi:signal
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_uptime
            name: "Uptime"
            icon: mdi:clock-outline

      # Sensors - Conditional visibility based on sensor settings
      - type: custom:fold-entity-row
        head:
          type: section
          label: üîç Sensors
        padding: 5
        entities:
          - type: conditional
            conditions:
              - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_sensor_enable_input
                state: "on"
            row:
              entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_fluid_input
              name: "Fluid Input"
              icon: mdi:water-check
          - type: conditional
            conditions:
              - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_sensor_enable_output
                state: "on"
            row:
              entity: binary_sensor.apollo_pump_1_{DEVICE_SUFFIX}_fluid_output
              name: "Fluid Output"
              icon: mdi:water-sync
          - entity: sensor.apollo_pump_1_{DEVICE_SUFFIX}_esp_temperature
            name: "ESP Temperature"
            icon: mdi:thermometer

      # Safety & Sensor Settings
      - type: custom:fold-entity-row
        head:
          type: section
          label: üõ°Ô∏è Safety & Sensor Settings
        padding: 5
        entities:
          - entity: number.apollo_pump_1_{DEVICE_SUFFIX}_safety_max_runtime_sec
            name: "Max Runtime (Seconds)"
            icon: mdi:shield-alert
          - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_safety_override
            name: "Safety Override"
            icon: mdi:shield-off
          - type: divider
          - entity: select.apollo_pump_1_{DEVICE_SUFFIX}_sensor_input_mode
            name: "INPUT Sensor Mode"
            icon: mdi:water-check
          - entity: select.apollo_pump_1_{DEVICE_SUFFIX}_sensor_output_mode
            name: "OUTPUT Sensor Mode"
            icon: mdi:water-sync

      # Additional Controls
      - type: custom:fold-entity-row
        head:
          type: section
          label: üéõÔ∏è Additional Controls
        padding: 5
        entities:
          - entity: light.apollo_pump_1_{DEVICE_SUFFIX}_rgb_light
            name: "RGB Light"
            icon: mdi:lightbulb
          - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_test_buzzer
            name: "Test Buzzer"
            icon: mdi:volume-high
          - entity: switch.apollo_pump_1_{DEVICE_SUFFIX}_pump_control
            name: "Pump Control"
            icon: mdi:pump
          - type: divider
          - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_system_reboot
            name: "üîÑ System Reboot"
            icon: mdi:restart-alert
          - entity: button.apollo_pump_1_{DEVICE_SUFFIX}_system_factory_reset
            name: "‚ö†Ô∏è Factory Reset"
            icon: mdi:alert-octagon
